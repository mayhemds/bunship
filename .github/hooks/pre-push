#!/bin/sh
# Pre-push hook for BunShip
# Install: cp .github/hooks/pre-push .git/hooks/pre-push && chmod +x .git/hooks/pre-push

set -e

echo "ðŸš€ Running pre-push checks..."

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Check if bun is installed
if ! command -v bun &> /dev/null; then
    echo "${RED}âœ— Bun is not installed${NC}"
    echo "Install from: https://bun.sh"
    exit 1
fi

echo "${BLUE}â†’ Checking code formatting...${NC}"
if ! bun run format:check; then
    echo "${RED}âœ— Code formatting failed${NC}"
    echo "${YELLOW}Run: bun run format${NC}"
    exit 1
fi
echo "${GREEN}âœ“ Code formatting OK${NC}"

echo "${BLUE}â†’ Running linter...${NC}"
if ! bun run lint; then
    echo "${RED}âœ— Linting failed${NC}"
    echo "${YELLOW}Try: bun run lint:fix${NC}"
    exit 1
fi
echo "${GREEN}âœ“ Linting passed${NC}"

echo "${BLUE}â†’ Type checking...${NC}"
if ! bun run typecheck; then
    echo "${RED}âœ— Type checking failed${NC}"
    exit 1
fi
echo "${GREEN}âœ“ Type checking passed${NC}"

echo "${BLUE}â†’ Running tests...${NC}"
if ! bun run test; then
    echo "${RED}âœ— Tests failed${NC}"
    exit 1
fi
echo "${GREEN}âœ“ Tests passed${NC}"

echo "${BLUE}â†’ Building...${NC}"
if ! bun run build; then
    echo "${RED}âœ— Build failed${NC}"
    exit 1
fi
echo "${GREEN}âœ“ Build successful${NC}"

echo "${GREEN}âœ“ All pre-push checks passed${NC}"
exit 0
